<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Border Collusion Radar - NEMESIS</title>
    
    <!-- Leaflet CSS & JS for maps -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --cyan: #00D4FF;
            --teal: #00B4D8;
            --dark-bg: #0A0E1A;
            --dark-card: #0F1420;
            --green: #10a37f;
            --red: #dc2626;
            --amber: #ff9500;
            --text-primary: white;
            --text-secondary: #86868b;
            --border: #2a2a2a;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, var(--dark-bg), var(--dark-card));
            color: white;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            padding-top: 70px;
        }

        /* Navigation with Hamburger Menu */
        .site-header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            background: rgba(10, 14, 26, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .back-link {
            font-size: 16px;
            color: #00D4FF;
            text-decoration: none;
            transition: opacity 0.2s;
        }

        .back-link:hover {
            opacity: 0.8;
        }

        /* Main Container */
        .container {
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px 20px;
            width: 100%;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .badge {
            display: inline-block;
            background: linear-gradient(135deg, var(--cyan), var(--teal));
            color: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 48px;
            margin-bottom: 16px;
            background: linear-gradient(135deg, white, var(--cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 21px;
            color: var(--text-secondary);
        }

        /* Input Section */
        .input-section {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 40px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        .input-row {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .input-group {
            flex: 1;
        }

        .input-label {
            display: block;
            color: var(--text-secondary);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .select-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 212, 255, 0.2);
            color: white;
            padding: 14px 16px;
            border-radius: 12px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .select-input:focus {
            outline: none;
            border-color: var(--cyan);
            background: rgba(0, 212, 255, 0.05);
        }

        .scan-button {
            background: linear-gradient(135deg, var(--cyan), var(--teal));
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 28px;
        }

        .scan-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 212, 255, 0.3);
        }

        .hotspots {
            margin-top: 20px;
        }

        .hotspots-label {
            color: var(--text-secondary);
            margin-bottom: 10px;
            font-size: 14px;
        }

        .hotspot-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .hotspot-btn {
            background: rgba(0, 212, 255, 0.1);
            border: 1px solid rgba(0, 212, 255, 0.2);
            color: var(--cyan);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .hotspot-btn:hover {
            background: rgba(0, 212, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Loading State */
        .loading-state {
            display: none;
            background: var(--dark-card);
            border-radius: 20px;
            padding: 60px;
            text-align: center;
            border: 1px solid rgba(0, 212, 255, 0.1);
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }

        .radar-sweep {
            width: 200px;
            height: 200px;
            margin: 0 auto 30px;
            position: relative;
        }

        .radar-circle {
            position: absolute;
            border: 2px solid var(--cyan);
            border-radius: 50%;
            opacity: 0.3;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .radar-circle:nth-child(1) { width: 50px; height: 50px; }
        .radar-circle:nth-child(2) { width: 100px; height: 100px; }
        .radar-circle:nth-child(3) { width: 150px; height: 150px; }
        .radar-circle:nth-child(4) { width: 200px; height: 200px; }

        .radar-sweep-line {
            position: absolute;
            width: 100px;
            height: 2px;
            background: linear-gradient(to right, transparent, var(--cyan));
            top: 50%;
            left: 50%;
            transform-origin: 0 50%;
            animation: radarSweep 2s linear infinite;
        }

        @keyframes radarSweep {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 18px;
            color: var(--cyan);
            margin-bottom: 10px;
        }

        .loading-step {
            font-size: 14px;
            color: var(--text-secondary);
        }

        /* Results Section */
        .results-section {
            display: none;
        }

        /* Sector Risk Header */
        .risk-header {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        .risk-main {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .sector-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .sector-icon {
            font-size: 48px;
        }

        .sector-details h2 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .sector-stats {
            color: var(--text-secondary);
        }

        .risk-gauge {
            text-align: center;
        }

        .risk-score {
            font-size: 48px;
            font-weight: bold;
            background: linear-gradient(135deg, var(--red), var(--amber));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .risk-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-transform: uppercase;
        }

        .alert-count {
            background: rgba(220, 38, 38, 0.1);
            border: 1px solid var(--red);
            padding: 8px 16px;
            border-radius: 20px;
            color: var(--red);
            font-weight: 600;
        }

        /* Map Container */
        .map-section {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        #eu-map {
            width: 100%;
            height: 500px;
            border-radius: 12px;
            background: #0A0E1A;
        }

        /* Map Controls */
        .map-controls {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            justify-content: center;
        }

        .layer-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 212, 255, 0.2);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .layer-toggle:hover {
            background: rgba(0, 212, 255, 0.1);
        }

        .layer-toggle input {
            cursor: pointer;
        }

        .layer-toggle label {
            cursor: pointer;
            font-size: 14px;
        }

        /* Cartel Cards */
        .cartels-section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--cyan);
        }

        .cartel-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
        }

        .cartel-card {
            background: var(--dark-card);
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 16px;
            padding: 25px;
            position: relative;
        }

        .cartel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .cartel-alert {
            color: var(--red);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .confidence-badge {
            background: rgba(220, 38, 38, 0.1);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 14px;
            color: var(--red);
        }

        .cartel-players {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            font-family: monospace;
            font-size: 14px;
        }

        .player {
            margin-bottom: 8px;
            padding-left: 20px;
        }

        .cartel-pattern {
            color: var(--amber);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .cartel-description {
            color: var(--text-secondary);
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .federated-insight {
            background: rgba(0, 212, 255, 0.05);
            border-left: 3px solid var(--cyan);
            padding: 15px;
            border-radius: 8px;
        }

        .insight-title {
            color: var(--cyan);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .country-view {
            margin-bottom: 5px;
            color: var(--text-secondary);
        }

        .alert-view {
            color: var(--red);
            font-weight: 600;
            margin-top: 10px;
        }

        /* Anomalies Table */
        .anomalies-section {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        .anomalies-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .anomalies-table th {
            background: rgba(0, 212, 255, 0.1);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            color: var(--cyan);
            border-bottom: 2px solid var(--cyan);
        }

        .anomalies-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .anomalies-table tr:hover {
            background: rgba(0, 212, 255, 0.05);
            cursor: pointer;
        }

        .confidence-high { color: var(--red); }
        .confidence-medium { color: var(--amber); }
        .confidence-low { color: var(--green); }

        /* Competition Metrics */
        .metrics-section {
            background: var(--dark-card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(0, 212, 255, 0.1);
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .metric-benchmark {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .metric-warning { color: var(--amber); }
        .metric-danger { color: var(--red); }
        .metric-success { color: var(--green); }

        /* Comparison View */
        .comparison-section {
            background: linear-gradient(135deg, rgba(0, 212, 255, 0.1), rgba(0, 180, 216, 0.05));
            border: 2px solid var(--cyan);
            border-radius: 20px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }

        .comparison-side {
            text-align: center;
        }

        .comparison-title {
            font-size: 20px;
            margin-bottom: 20px;
            color: var(--cyan);
        }

        .comparison-content {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            border-radius: 12px;
            min-height: 200px;
        }

        .comparison-stat {
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        /* Footer */
        footer {
            background: rgba(15, 20, 32, 0.95);
            padding: 40px 20px;
            text-align: center;
            border-top: 1px solid rgba(0, 212, 255, 0.1);
            margin-top: auto;
        }

        .footer-note {
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 10px;
        }

        .footer-link {
            color: var(--cyan);
            text-decoration: none;
            font-weight: 500;
        }

        /* Responsive */
        @media (max-width: 768px) {
            h1 { font-size: 32px; }
            .input-row { flex-direction: column; }
            .cartel-cards { grid-template-columns: 1fr; }
            .comparison-grid { grid-template-columns: 1fr; }
            #eu-map { height: 350px; }
            .nav-links { display: none; }
            .map-controls { flex-wrap: wrap; }
        }

        /* Custom map styles */
        .leaflet-container {
            background: #0A0E1A;
            font-family: inherit;
        }

        .country-polygon {
            transition: all 0.3s ease;
        }

        .cartel-flow-line {
            stroke: var(--red);
            stroke-width: 2;
            fill: none;
            opacity: 0.7;
            stroke-dasharray: 5, 5;
            animation: flowAnimation 2s linear infinite;
        }

        @keyframes flowAnimation {
            to {
                stroke-dashoffset: -10;
            }
        }

        .anomaly-marker {
            background: var(--red);
            border: 2px solid white;
            border-radius: 50%;
            width: 12px;
            height: 12px;
            animation: markerPulse 2s infinite;
        }

        @keyframes markerPulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.5);
                opacity: 0.7;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <header class="site-header">
        <div class="header-container">
            <a href="index.html" class="back-link">‚Üê Back to Nemesis</a>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="badge">Cross-Border Analysis</div>
            <h1>Collusion Radar</h1>
            <p class="subtitle">Detect invisible cartels and market division across EU procurement</p>
        </div>

        <!-- Input Section -->
        <div class="input-section" id="inputSection">
            <div class="input-row">
                <div class="input-group">
                    <label class="input-label">Select Sector</label>
                    <select class="select-input" id="sectorSelect">
                        <option value="construction">Construction & Civil Engineering</option>
                        <option value="it">IT Services & Software</option>
                        <option value="healthcare">Healthcare & Medical Supplies</option>
                        <option value="transport">Transportation & Logistics</option>
                        <option value="energy">Energy & Utilities</option>
                        <option value="consulting">Consulting & Professional Services</option>
                    </select>
                </div>
                <div class="input-group">
                    <label class="input-label">Focus Country (Optional)</label>
                    <select class="select-input" id="countrySelect">
                        <option value="all">All EU Countries</option>
                        <option value="DE">Germany</option>
                        <option value="FR">France</option>
                        <option value="IT">Italy</option>
                        <option value="ES">Spain</option>
                        <option value="PL">Poland</option>
                        <option value="NL">Netherlands</option>
                        <option value="BE">Belgium</option>
                        <option value="AT">Austria</option>
                        <option value="CZ">Czech Republic</option>
                        <option value="HU">Hungary</option>
                        <option value="SE">Sweden</option>
                        <option value="DK">Denmark</option>
                        <option value="FI">Finland</option>
                    </select>
                </div>
                <button class="scan-button" onclick="scanForCollusion()">
                    Scan for Collusion Patterns
                </button>
            </div>
            
            <div class="hotspots">
                <div class="hotspots-label">Try these hotspots:</div>
                <div class="hotspot-buttons">
                    <button class="hotspot-btn" onclick="loadHotspot('construction', 'DE')">
                        Construction + Germany
                    </button>
                    <button class="hotspot-btn" onclick="loadHotspot('it', 'all')">
                        IT Services + All EU
                    </button>
                    <button class="hotspot-btn" onclick="loadHotspot('healthcare', 'eastern')">
                        Healthcare + Eastern Europe
                    </button>
                    <button class="hotspot-btn" onclick="loadHotspot('transport', 'FR')">
                        Transportation + France
                    </button>
                    <button class="hotspot-btn" onclick="loadHotspot('energy', 'nordic')">
                        Energy + Nordic (Clean)
                    </button>
                </div>
            </div>
        </div>

        <!-- Loading State -->
        <div class="loading-state" id="loadingState">
            <div class="radar-sweep">
                <div class="radar-circle"></div>
                <div class="radar-circle"></div>
                <div class="radar-circle"></div>
                <div class="radar-circle"></div>
                <div class="radar-sweep-line"></div>
            </div>
            <div class="loading-text" id="loadingText">Aggregating cross-border tender data...</div>
            <div class="loading-step" id="loadingStep">Scanning 27 national databases</div>
        </div>

        <!-- Results Section -->
        <div class="results-section" id="resultsSection">
            <!-- Risk Header -->
            <div class="risk-header">
                <div class="risk-main">
                    <div class="sector-info">
                        <div class="sector-icon" id="sectorIcon">üèóÔ∏è</div>
                        <div class="sector-details">
                            <h2 id="sectorName">Construction & Civil Engineering</h2>
                            <div class="sector-stats" id="sectorStats">‚Ç¨12.4B analyzed across 27 countries</div>
                        </div>
                    </div>
                    <div class="risk-gauge">
                        <div class="risk-score" id="riskScore">72</div>
                        <div class="risk-label">Collusion Risk</div>
                    </div>
                    <div class="alert-count" id="alertCount">
                        17 patterns detected
                    </div>
                </div>
            </div>

            <!-- Map Section -->
            <div class="map-section">
                <div id="eu-map"></div>
                <div class="map-controls">
                    <div class="layer-toggle">
                        <input type="checkbox" id="heatLayer" checked>
                        <label for="heatLayer">Concentration Risk</label>
                    </div>
                    <div class="layer-toggle">
                        <input type="checkbox" id="flowLayer" checked>
                        <label for="flowLayer">Cross-Border Flows</label>
                    </div>
                    <div class="layer-toggle">
                        <input type="checkbox" id="divisionLayer" checked>
                        <label for="divisionLayer">Market Division</label>
                    </div>
                    <div class="layer-toggle">
                        <input type="checkbox" id="anomalyLayer" checked>
                        <label for="anomalyLayer">Anomalies</label>
                    </div>
                </div>
            </div>

            <!-- Detected Cartels -->
            <div class="cartels-section">
                <h3 class="section-title">Detected Cartels</h3>
                <div class="cartel-cards" id="cartelCards">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Statistical Anomalies -->
            <div class="anomalies-section">
                <h3 class="section-title">Statistical Anomalies</h3>
                <table class="anomalies-table">
                    <thead>
                        <tr>
                            <th>Anomaly Type</th>
                            <th>Companies Involved</th>
                            <th>Countries</th>
                            <th>Confidence</th>
                            <th>Est. Overcharge</th>
                        </tr>
                    </thead>
                    <tbody id="anomaliesTable">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Competition Metrics -->
            <div class="metrics-section">
                <h3 class="section-title">Competition Health Metrics</h3>
                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-value metric-warning" id="avgBidders">3.2</div>
                        <div class="metric-label">Avg Bidders per Tender</div>
                        <div class="metric-benchmark">EU Benchmark: 5.1 ‚ö†Ô∏è</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value metric-danger" id="singleBidRate">34%</div>
                        <div class="metric-label">Single-Bidder Rate</div>
                        <div class="metric-benchmark">EU Benchmark: 18% üö®</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value metric-warning" id="marketShare">67%</div>
                        <div class="metric-label">Top 10 Market Share</div>
                        <div class="metric-benchmark">Concentration Risk ‚ö†Ô∏è</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value metric-danger" id="crossBorder">8%</div>
                        <div class="metric-label">Cross-Border Bidding</div>
                        <div class="metric-benchmark">Low = Barriers üö®</div>
                    </div>
                </div>
            </div>

            <!-- NEMESIS Advantage -->
            <div class="comparison-section">
                <h3 class="section-title" style="text-align: center;">The NEMESIS Advantage</h3>
                <div class="comparison-grid">
                    <div class="comparison-side">
                        <h4 class="comparison-title">What One Country Sees</h4>
                        <div class="comparison-content">
                            <div class="comparison-stat">
                                <strong>Germany analyzed:</strong> 45,000 tenders
                            </div>
                            <div class="comparison-stat">
                                <strong>Found:</strong> 12 suspicious patterns
                            </div>
                            <div class="comparison-stat">
                                <strong>Bauwerk GmbH:</strong> Top contractor, 34% win rate
                            </div>
                            <div class="comparison-stat" style="color: var(--green);">
                                ‚úì "Looks successful and legitimate"
                            </div>
                        </div>
                    </div>
                    <div class="comparison-side">
                        <h4 class="comparison-title">What NEMESIS Sees</h4>
                        <div class="comparison-content">
                            <div class="comparison-stat">
                                <strong>NEMESIS analyzed:</strong> 2.1M tenders
                            </div>
                            <div class="comparison-stat">
                                <strong>Found:</strong> 847 cross-border patterns
                            </div>
                            <div class="comparison-stat">
                                <strong>Bauwerk GmbH:</strong> Part of 3-company cartel
                            </div>
                            <div class="comparison-stat" style="color: var(--red);">
                                üö® "Dividing ‚Ç¨890M market illegally"
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p class="footer-note">
            Demonstration using synthesized patterns based on academic procurement research. 
            Production NEMESIS analyzes live TED data with federated learning across all 27 EU member states.
        </p>
        <p class="footer-note">
            Sources: Patterns based on European Commission cartel decisions and academic literature on bid-rigging detection.
        </p>
        <a href="index.html" class="footer-link">‚Üê Back to NEMESIS Main Page</a>
    </footer>

    <script>
        // Sector data
        const sectorData = {
            construction: {
                icon: 'üèóÔ∏è',
                name: 'Construction & Civil Engineering',
                riskScore: 72,
                alertCount: 17,
                stats: '‚Ç¨89.4B analyzed across 27 countries',
                avgBidders: 3.2,
                singleBidRate: 34,
                marketShare: 67,
                crossBorder: 8,
                cartels: [
                    {
                        confidence: 94,
                        pattern: 'Market Division',
                        players: [
                            'Bauwerk GmbH ‚Üí 89% wins in DE/AT (‚Ç¨234M)',
                            'Constructions SA ‚Üí 91% wins in FR/BE (‚Ç¨198M)',
                            'Edifici SpA ‚Üí 87% wins in IT (‚Ç¨156M)'
                        ],
                        description: 'These 3 companies have NEVER competed against each other despite operating in adjacent markets for 6+ years.',
                        insights: {
                            de: 'Bauwerk is our top contractor ‚úì',
                            fr: 'Constructions SA is our top contractor ‚úì',
                            it: 'Edifici SpA is our top contractor ‚úì',
                            nemesis: 'These companies are coordinating to avoid competition'
                        }
                    },
                    {
                        confidence: 87,
                        pattern: 'Bid Rotation',
                        players: [
                            'Alpine Bau ‚Üí Wins Q1 tenders',
                            'Donau Construction ‚Üí Wins Q2 tenders',
                            'Rhine Builders ‚Üí Wins Q3 tenders',
                            'Elbe Works ‚Üí Wins Q4 tenders'
                        ],
                        description: 'Perfect quarterly rotation pattern detected in Bavaria region over 3 years.',
                        insights: {
                            de: 'Different winners each quarter - looks competitive ‚úì',
                            nemesis: 'Mathematical probability of this pattern: <0.001%'
                        }
                    }
                ],
                anomalies: [
                    { type: 'Bid Rotation', companies: 'Alpha, Beta, Gamma', countries: 'DE, PL, CZ', confidence: 91, overcharge: '‚Ç¨45M' },
                    { type: 'Market Division', companies: 'X Corp, Y Ltd', countries: 'FR, ES', confidence: 87, overcharge: '‚Ç¨112M' },
                    { type: 'Cover Bidding', companies: 'Main Co + 3 shells', countries: 'NL, BE', confidence: 95, overcharge: '‚Ç¨23M' },
                    { type: 'Price Fixing', companies: '6 companies', countries: 'IT region', confidence: 82, overcharge: '‚Ç¨67M' }
                ]
            },
            it: {
                icon: 'üíª',
                name: 'IT Services & Software',
                riskScore: 68,
                alertCount: 23,
                stats: '‚Ç¨45.7B analyzed across 27 countries',
                avgBidders: 2.8,
                singleBidRate: 42,
                marketShare: 71,
                crossBorder: 12,
                cartels: [
                    {
                        confidence: 89,
                        pattern: 'Shell Company Network',
                        players: [
                            'TechServ Luxembourg SA ‚Üí ‚Ç¨89M in contracts',
                            'Digital Solutions Ireland Ltd ‚Üí ‚Ç¨67M',
                            'Cyber Systems Malta ‚Üí ‚Ç¨45M',
                            'All registered to same address in Luxembourg'
                        ],
                        description: 'Complex shell network winning contracts across EU while registered in tax havens.',
                        insights: {
                            various: 'Local IT company winning contracts ‚úì',
                            nemesis: 'All companies trace back to single beneficial owner'
                        }
                    }
                ],
                anomalies: [
                    { type: 'Shell Network', companies: '12 entities', countries: 'LU, IE, MT', confidence: 89, overcharge: '‚Ç¨201M' },
                    { type: 'Cover Bidding', companies: 'TechCorp + phantoms', countries: 'All EU', confidence: 93, overcharge: '‚Ç¨156M' }
                ]
            },
            healthcare: {
                icon: 'üè•',
                name: 'Healthcare & Medical Supplies',
                riskScore: 81,
                alertCount: 31,
                stats: '‚Ç¨156.3B analyzed across 27 countries',
                avgBidders: 2.4,
                singleBidRate: 48,
                marketShare: 78,
                crossBorder: 5,
                cartels: [
                    {
                        confidence: 96,
                        pattern: 'Price Fixing Cartel',
                        players: [
                            'MedSupply Europe ‚Üí Controls ventilators',
                            'HealthTech GmbH ‚Üí Controls PPE',
                            'Pharma Logistics ‚Üí Controls vaccines transport'
                        ],
                        description: 'Prices always within 1.5% across all tenders. Statistical impossibility.',
                        insights: {
                            pl: 'Competitive bidding on medical supplies ‚úì',
                            hu: 'Multiple bidders participating ‚úì',
                            cz: 'Fair market prices ‚úì',
                            nemesis: 'Coordinated price fixing across Eastern Europe'
                        }
                    }
                ],
                anomalies: [
                    { type: 'Price Fixing', companies: '8 medical cos', countries: 'PL, HU, CZ, SK', confidence: 96, overcharge: '‚Ç¨312M' }
                ]
            },
            transport: {
                icon: 'üöõ',
                name: 'Transportation & Logistics',
                riskScore: 64,
                alertCount: 12,
                stats: '‚Ç¨67.8B analyzed across 27 countries',
                avgBidders: 3.8,
                singleBidRate: 28,
                marketShare: 54,
                crossBorder: 15,
                cartels: [
                    {
                        confidence: 83,
                        pattern: 'Regional Bid Rotation',
                        players: [
                            'TransFrance Nord ‚Üí Wins northern regions',
                            'TransFrance Sud ‚Üí Wins southern regions',
                            'TransFrance Est ‚Üí Wins eastern regions'
                        ],
                        description: 'Same parent company subsidiaries dividing French market geographically.',
                        insights: {
                            fr: 'Different companies winning in each region ‚úì',
                            nemesis: 'All subsidiaries of same holding company'
                        }
                    }
                ],
                anomalies: [
                    { type: 'Geographic Split', companies: 'TransGroup subs', countries: 'FR regions', confidence: 83, overcharge: '‚Ç¨89M' }
                ]
            },
            energy: {
                icon: '‚ö°',
                name: 'Energy & Utilities',
                riskScore: 28,
                alertCount: 3,
                stats: '‚Ç¨234.5B analyzed across 27 countries',
                avgBidders: 5.2,
                singleBidRate: 18,
                marketShare: 42,
                crossBorder: 23,
                cartels: [],
                anomalies: [
                    { type: 'Minor Anomaly', companies: 'EnergyNord', countries: 'SE, FI', confidence: 45, overcharge: '‚Ç¨12M' }
                ]
            }
        };

        let map = null;
        let currentSector = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Layer toggle listeners
            ['heatLayer', 'flowLayer', 'divisionLayer', 'anomalyLayer'].forEach(id => {
                document.getElementById(id).addEventListener('change', updateMapLayers);
            });
        });

        // Load hotspot
        function loadHotspot(sector, country) {
            document.getElementById('sectorSelect').value = sector;
            document.getElementById('countrySelect').value = country === 'eastern' ? 'PL' : 
                                                           country === 'nordic' ? 'SE' : country;
            scanForCollusion();
        }

        // Scan for collusion
        async function scanForCollusion() {
            const sector = document.getElementById('sectorSelect').value;
            const country = document.getElementById('countrySelect').value;
            
            currentSector = sectorData[sector];

            // Show loading
            await showLoadingState();

            // Display results
            displayResults(currentSector, sector, country);
        }

        // Show loading state
        async function showLoadingState() {
            document.getElementById('inputSection').style.display = 'none';
            document.getElementById('resultsSection').style.display = 'none';
            document.getElementById('loadingState').style.display = 'block';

            const steps = [
                { text: 'Aggregating cross-border tender data...', step: 'Scanning 27 national databases' },
                { text: 'Computing win rate anomalies...', step: 'Statistical analysis in progress' },
                { text: 'Detecting market division patterns...', step: 'Mapping geographic concentrations' },
                { text: 'Identifying bid rotation rings...', step: 'Pattern recognition complete' }
            ];

            for (let i = 0; i < steps.length; i++) {
                document.getElementById('loadingText').textContent = steps[i].text;
                document.getElementById('loadingStep').textContent = steps[i].step;
                await sleep(700);
            }

            document.getElementById('loadingState').style.display = 'none';
        }

        // Display results
        function displayResults(data, sector, country) {
            document.getElementById('resultsSection').style.display = 'block';

            // Update header
            document.getElementById('sectorIcon').textContent = data.icon;
            document.getElementById('sectorName').textContent = data.name;
            document.getElementById('sectorStats').textContent = data.stats;
            document.getElementById('riskScore').textContent = data.riskScore;
            document.getElementById('alertCount').textContent = `${data.alertCount} patterns detected`;

            // Update metrics
            document.getElementById('avgBidders').textContent = data.avgBidders;
            document.getElementById('singleBidRate').textContent = data.singleBidRate + '%';
            document.getElementById('marketShare').textContent = data.marketShare + '%';
            document.getElementById('crossBorder').textContent = data.crossBorder + '%';

            // Color code metrics
            document.getElementById('avgBidders').className = 'metric-value ' + 
                (data.avgBidders < 3 ? 'metric-danger' : data.avgBidders < 4 ? 'metric-warning' : 'metric-success');
            document.getElementById('singleBidRate').className = 'metric-value ' + 
                (data.singleBidRate > 30 ? 'metric-danger' : data.singleBidRate > 20 ? 'metric-warning' : 'metric-success');

            // Create map
            createMap(sector, country);

            // Display cartels
            displayCartels(data.cartels);

            // Display anomalies
            displayAnomalies(data.anomalies);

            // Scroll to results
            document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
        }

        // Create EU map
        function createMap(sector, country) {
            // Remove existing map
            if (map) {
                map.remove();
            }

            // Create new map
            map = L.map('eu-map').setView([52, 10], 4);

            // Dark tile layer
            L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
                attribution: '¬© OpenStreetMap contributors',
                maxZoom: 19
            }).addTo(map);

            // Add EU countries (simplified for demo)
            const euCountries = {
                'DE': { center: [51.1657, 10.4515], risk: 'high', value: 234 },
                'FR': { center: [46.2276, 2.2137], risk: 'high', value: 198 },
                'IT': { center: [41.8719, 12.5674], risk: 'high', value: 156 },
                'ES': { center: [40.4637, -3.7492], risk: 'medium', value: 89 },
                'PL': { center: [51.9194, 19.1451], risk: 'medium', value: 78 },
                'NL': { center: [52.1326, 5.2913], risk: 'medium', value: 67 },
                'BE': { center: [50.5039, 4.4699], risk: 'high', value: 98 },
                'AT': { center: [47.5162, 14.5501], risk: 'high', value: 112 },
                'CZ': { center: [49.7500, 15.5000], risk: 'medium', value: 56 },
                'HU': { center: [47.1625, 19.5033], risk: 'medium', value: 45 }
            };

            // Add country markers
            Object.entries(euCountries).forEach(([code, data]) => {
                const color = data.risk === 'high' ? '#dc2626' : 
                             data.risk === 'medium' ? '#ff9500' : '#10a37f';
                
                const circle = L.circleMarker(data.center, {
                    radius: Math.sqrt(data.value) * 2,
                    fillColor: color,
                    color: '#fff',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.5
                }).addTo(map);

                circle.bindPopup(`
                    <strong>${code}</strong><br>
                    Risk Level: ${data.risk}<br>
                    Contract Value: ‚Ç¨${data.value}M
                `);
            });

            // Add flow lines for high-risk sectors
            if (sector === 'construction' || sector === 'it') {
                // Germany-France-Italy cartel triangle
                const latlngs = [
                    euCountries['DE'].center,
                    euCountries['FR'].center,
                    euCountries['IT'].center
                ];
                
                L.polyline(latlngs, {
                    color: '#dc2626',
                    weight: 3,
                    opacity: 0.7,
                    dashArray: '10, 10',
                    className: 'cartel-flow-line'
                }).addTo(map);
            }

            // Add anomaly markers
            if (sector !== 'energy') {
                const anomalyIcon = L.divIcon({
                    className: 'anomaly-marker',
                    iconSize: [12, 12]
                });

                // Add some anomaly markers
                L.marker([52.5200, 13.4050], { icon: anomalyIcon }).addTo(map)
                    .bindPopup('üö® Bid rotation detected<br>Berlin region');
                L.marker([48.8566, 2.3522], { icon: anomalyIcon }).addTo(map)
                    .bindPopup('üö® Price fixing pattern<br>Paris region');
                L.marker([45.4642, 9.1900], { icon: anomalyIcon }).addTo(map)
                    .bindPopup('üö® Shell companies<br>Milan region');
            }
        }

        // Update map layers
        function updateMapLayers() {
            // In a real implementation, this would toggle map layers
            console.log('Updating map layers');
        }

        // Display cartels
        function displayCartels(cartels) {
            const container = document.getElementById('cartelCards');
            container.innerHTML = '';

            if (cartels.length === 0) {
                container.innerHTML = '<p style="color: var(--green); text-align: center;">‚úì No major cartels detected in this sector</p>';
                return;
            }

            cartels.forEach(cartel => {
                const card = document.createElement('div');
                card.className = 'cartel-card';
                
                const insights = Object.entries(cartel.insights)
                    .filter(([key, value]) => key !== 'nemesis')
                    .map(([key, value]) => `<div class="country-view">${key.toUpperCase()} alone sees: "${value}"</div>`)
                    .join('');

                card.innerHTML = `
                    <div class="cartel-header">
                        <div class="cartel-alert">
                            <span>üö®</span>
                            <span>MARKET DIVISION DETECTED</span>
                        </div>
                        <div class="confidence-badge">Confidence: ${cartel.confidence}%</div>
                    </div>
                    
                    <div class="cartel-players">
                        <div style="margin-bottom: 10px;">Players:</div>
                        ${cartel.players.map(p => `<div class="player">‚îú‚îÄ ${p}</div>`).join('')}
                    </div>
                    
                    <div class="cartel-pattern">Pattern: ${cartel.pattern}</div>
                    <div class="cartel-description">${cartel.description}</div>
                    
                    <div class="federated-insight">
                        <div class="insight-title">Exposed by federated analysis:</div>
                        ${insights}
                        <div class="alert-view">Together: "${cartel.insights.nemesis}" üö®</div>
                    </div>
                `;
                
                container.appendChild(card);
            });
        }

        // Display anomalies
        function displayAnomalies(anomalies) {
            const tbody = document.getElementById('anomaliesTable');
            tbody.innerHTML = '';

            anomalies.forEach(anomaly => {
                const row = document.createElement('tr');
                const confidenceClass = anomaly.confidence >= 90 ? 'confidence-high' :
                                       anomaly.confidence >= 70 ? 'confidence-medium' : 'confidence-low';
                
                row.innerHTML = `
                    <td>${anomaly.type}</td>
                    <td>${anomaly.companies}</td>
                    <td>${anomaly.countries}</td>
                    <td class="${confidenceClass}">${anomaly.confidence}%</td>
                    <td>${anomaly.overcharge}</td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // Sleep helper
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // No JavaScript needed for simple back link navigation
    </script>
</body>
</html>